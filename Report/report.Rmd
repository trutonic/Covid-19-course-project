---
title: "Exploratory Analysis on the Effect of COVID-19 on GDP"
author: "Ian Whaling 914014658, Samuel Becerra Martinez 914309570, Esmeralda Buenrostro 915430778, Ryan Truong 916857334, Team ID: 9"
date: "March 3rd, 2021"
output:
  html_document:
    df_print: paged
    number_sections: yes
---
```{r, echo=FALSE,warning=FALSE,message=FALSE}
library(tidyverse)
library(rworldmap)
library(car)
```

# Abstract 

The spread of COVID-19 had detrimental effects on economic activities following worldwide lockdowns. Our primary interest was whether there were differences among countries' ability to recover from the initial negative economic association of COVID-19 based on two factors: overall wealth and proportion of the population with COVID-19 infections. To measure the number of infections, we used the COVID-19 dataset from the WHO Website, which granted us information about infections and deaths for various countries daily. We also looked into 2 other datasets to explore the GDP change per quarter in 2020 and a country's overall wealth, measured by GDP per capita, to gain insight about its economic standing prior to the pandemic. We decided to incorporate a two-way ANOVA model to explain the difference in the percentage change in GDP from fiscal quarter 2 to fiscal quarter 3 between countries. We incorporated the population infected with COVID-19 and the GDP per capita of each nation in quarter 3 as predictors to try to account for the variance in GDP percentages. To incorporate these values into our model, we split the population infected with COVID-19 into levels relative to the number of infections and subsequently split the percentage change in GDP into levels based on the proportion of infections. We measured the statistical significance of the differences observed in percentage change in GDP and ran diagnostics to test if there were any errors in our assumptions. We also ran the non-parametric Kruskal-Wallis test to further test our assumptions across these different groups.

# Introduction

COVID-19 came to shock the world socially, politically, and economically. Many governments made the decision to lockdown their countries in response to COVID-19 as a way to limit the spread of the virus. This came with direct costs to economic activities as many businesses were forced to halt their operations or adapt to regulations in order to keep productivity afloat. In this paper, we measure the association of COVID-19 on the economy by examining the effects of COVID-related cases and nominal GDP. We use GDP as a measurement of the economy as it tracks income and spending in the economy, and it can be compared with other countries and across time. We also note the third quarter of 2020 witnessed widespread economic recovery due to relaxations of regulations made following the initial lockdowns during quarter 2. Quarter 2 was also the period many countries saw the initial waves of COVID-19 cases. We use this timeframe to carefully observe the changes in GDP across various countries. 
 
Our primary interest is whether there are differences across countries’ ability to recover from the initial negative economic association of COVID-19 due to the factors: proportion of the population with COVID-19 infections and relative wealth of a nation. The incentive behind this question was the lockdown and the closure of many businesses worldwide as a preventative measure to limit the spread of the virus. According to Ozili and Arun (2020), their findings showed that a 30-day social distancing policy or lockdown restriction hurt the economy through the reduction in the level of general economic activities and through its negative effect on stock prices. We questioned how the economy would respond in the months following this initial closure of many economic activities and whether factors like wealth and the number of positive COVID-19 results had any association with these results. We figured that if certain countries seemed to recuperate their GDP losses from COVID-19 quicker than others, then the country’s overall wealth and proportion of the population with COVID-19 may have been factors. Results may give us an indication of how economies are likely to respond to global pandemics such as COVID-19 in the future. In the instance that higher proportions of positive COVID-19 cases have a larger negative association on the economy, then a country may consider placing even stricter restrictions on their country at the beginning of a pandemic to try to combat this negative association. Similarly, countries with a low GDP relative to other countries may have more difficulty recovering from higher COVID-19 infections, which may lead to a collapse of their economy and require intervention from other countries.  

# Background 

For our data, we use a csv file containing COVID-19 from the WHO website which can be found [here](https://covid19.who.int/WHO-COVID-19-global-data.csv). This dataset consists of 8 variables: the date reported, country code, country, WHO region, new cases, cumulative cases, new deaths, and cumulative deaths. Dates reported are calendar dates ranging from January 3, 2020 to present. There are 116 distinct countries with two-letter country codes to identify the country. These countries are broken up into 6 geographic regions: EMRO, EURO, AFRO, WPRO, AMRO and SEARO. New cases, cumulative cases, new deaths, and cumulative deaths utilize numerical values to describe quantities of COVID-19 infections and deaths. Information about WHO regions and country codes can be found on the WHO website. The dataset is maintained and updated regularly by WHO. The WHO makes a statement about the dataset in their overview that "all counts are subject to variations in case detection, definitions, laboratory test, and reporting strategies between countries, states, and territories." The case/death data is based on WHO case definitions which can be found [here](https://www.who.int/publications/i/item/who-2019-nCoV-surveillanceguidance-2020.8). The collection of the data was started on the 3rd of January 2020, and collection is still on-going at the time this paper was written. The WHO sources their data through cases and deaths communicated by the International Health Regulation and reconciles this data through official ministries of health websites and social media accounts. Negative numbers may appear in the dataset as reconciliation exercises are performed to keep the data as accurate as possible. 

The population that we are interested in is nations and their change in GDP. We will be attempting to model this population respective to their levels of proportion of people that are infected with COVID-19 and GDP per capita (as a measure of overall wealth). To measure the differences across countries' abilities to recover from the initial association of COVID-19, we chose to split the data into fiscal quarters, which are quarter periods that align with a regular calendar year. We decided to use quarter 3 in 2020 or Q3 to measure the recovery from the initial negative associations of COVID-19 on the economy, mainly seen in Q2. To keep within this time frame, we summed all the COVID-19 cases within Q3, which spans from July 1, 2020 to September 30, 2020. The variables that we chose to include are: “Change_3_months” which explains the percentage change in GDP from Q2 to Q3 of 2020 for each country. We also include “Increase_cat”, which groups countries based on the proportion of their populations infected by COVID-19 (Lowest, Moderate, Highest). “Gdp_cat” groups countries based on their relative wealth, measured by GDP per capita (Poor, Moderate, Wealthy).


# Descriptive analysis 

## COVID-19 WHO Dataset

### Countries
The COVID-19 data set that came from the WHO website contains 101,199 observations with 8 variables as previously stated. 237 countries are included in this dataset and can be shown in the following map: 

```{r, message=FALSE,echo=FALSE, warning=FALSE}
original_covid_data = read_csv("https://covid19.who.int/WHO-COVID-19-global-data.csv")
# covid$Case_mortality_rate = covid$Cumulative_cases / covid$Cumulative_deaths
# covid$Case_mortality_rate[is.nan(covid$Case_mortality_rate)] = 0
# 
# summary(covid$Date_reported)
# summary(covid$New_cases)
# summary(covid$Cumulative_cases)
# summary(covid$New_deaths)
# summary(covid$Cumulative_deaths)
iso3 <- read.csv("iso3.csv")
names = c()
codes = c()
for (i in 0:dim(iso3)[1]){
  row = iso3[i,]
  c = substr(row,1,3)
  n = substr(row,5,nchar(row))
  names = append(names, n)
  codes = append(codes, c)
}
iso3_df = tibble(country = names, iso3 = codes, using_these_countries = rep(1,length(names)))
iso3_df = iso3_df %>% add_row(country = "occupied Palestinian territory, including east Jerusalem",
                              iso3 = "PSE",
                              using_these_countries = 1)
iso3_df = iso3_df %>% add_row(country = "Republic of Korea",
                              iso3 = "KOR",
                              using_these_countries = 1)
iso3_df = iso3_df %>% add_row(country = "Republic of Moldova",
                              iso3 = "MDA",
                              using_these_countries = 1)
iso3_df = iso3_df %>% add_row(country = "United Republic of Tanzania",
                              iso3 = "TZA",
                              using_these_countries = 1)
iso3_df = iso3_df %>% add_row(country = "The United Kingdom",
                              iso3 = "GBR",
                              using_these_countries = 1)
iso3_df = iso3_df %>% add_row(country = "Democratic Republic of the Congo",
                              iso3 = "COD",
                              using_these_countries = 1)
iso3_df = iso3_df %>% add_row(country = "Côte d’Ivoire",
                              iso3 = "CIV",
                              using_these_countries = 1)
iso3_df = iso3_df %>% add_row(country = "Democratic People's Republic of Korea",
                              iso3 = "PRK",
                              using_these_countries = 1)

who_countries = original_covid_data%>% distinct(Country)
formap = merge(who_countries,iso3_df, by.x = c("Country"), by.y =c("country") )
formap = formap[,c(2,3)]

#Plot 
Map <- joinCountryData2Map(formap, joinCode = "ISO3", nameJoinColumn="iso3")
mapCountryData(Map, nameColumnToPlot="using_these_countries", catMethod = "categorical",
               missingCountryCol = gray(.8),
               mapTitle = "Countries in the WHO dataset",
               addLegend = FALSE)
```

### Dates

The dataset contains information about the countries since 2020-01-03 and the latest recorded date is 2021-03-04.

However we are only interested in the year 2020, thus the latest 2020 date is 12-31. We can see a summary statistics of the dates shown below: 
 
```{r,echo=FALSE}
dates_2020 = tibble(Date_reported= original_covid_data$Date_reported)
dates_2020 = subset(dates_2020,Date_reported >= "2020-01-01" & Date_reported <= "2020-12-31")
summary(dates_2020)
```

In our model, we decided to focus our interest not on the days but rather the quarters in the year. We manipulated the data to get the number of new cases, cumulative cases, new deaths, and cumulative death in a quarterly basis. The dates for each quarter are as follows:

- Quarter 1:
  - 2020-01-01 to 2020-03-31
- Quarter 2:
  - 2020-04-01 to 2020-06-30
- Quarter 3:
  - 2020-07-01 to 2020-09-30
- Quarter 4:
  - 2020-10-01 to 2020-12-31

### Quarters  

As stated in the previous section, we decided to look at the data on quarterly time frames rather by days. The summary statistics for each variable per quarter are as follows: 

Where, 

- starting cases = number of cases at the begining of a quarter
- ending cases = number of cases at the end of a quarter
- total cases = the number of new cases (ie. the differnce between ending and starting cases)
- ... (same logic extends for 'deaths')

```{r,echo=FALSE}
covid <- original_covid_data %>% arrange(Date_reported)


get.quarter.info = function(covid){
  covid_quarter = tibble(quarter = "dmmy", country = "dmmy", starting_cases = -1, ending_cases = -1, total_cases = -1,
                         starting_deaths = -1, ending_deaths = -1, total_deaths = -1)
  
  all_countries = covid %>% distinct(Country)
  for (country_name in all_countries){
    one_country <- covid %>% filter(Country == country_name)
    Q1 = subset(one_country,Date_reported >= "2020-01-01" & Date_reported <= "2020-03-31")
    Q2 = subset(one_country,Date_reported >= "2020-04-01" & Date_reported <= "2020-06-30")
    Q3 = subset(one_country,Date_reported >= "2020-07-01" & Date_reported <= "2020-09-30")
    Q4 = subset(one_country,Date_reported >= "2020-10-01" & Date_reported <= "2020-12-31")
    
    Q1min =  Q1 %>% filter(Date_reported == min(Q1$Date_reported))
    Q1max =  Q1 %>% filter(Date_reported == max(Q1$Date_reported))
    
    Q2min =  Q2 %>% filter(Date_reported == min(Q2$Date_reported))
    Q2max =  Q2 %>% filter(Date_reported == max(Q2$Date_reported))
    
    Q3min =  Q3 %>% filter(Date_reported == min(Q3$Date_reported))
    Q3max =  Q3 %>% filter(Date_reported == max(Q3$Date_reported))
    
    Q4min =  Q4 %>% filter(Date_reported == min(Q4$Date_reported))
    Q4max =  Q4 %>% filter(Date_reported == max(Q4$Date_reported))
    
    covid_quarter = covid_quarter %>% add_row(quarter="Q1 / 2020", country = country_name,
                                              starting_cases= Q1min$Cumulative_cases, ending_cases = Q1max$Cumulative_cases, total_cases = Q1max$Cumulative_cases - Q1min$Cumulative_cases,
                                              starting_deaths= Q1min$Cumulative_deaths, ending_deaths = Q1max$Cumulative_deaths, total_deaths = Q1max$Cumulative_deaths - Q1min$Cumulative_deaths)
    
    covid_quarter = covid_quarter %>% add_row(quarter="Q2 / 2020", country = country_name,
                                              starting_cases= Q2min$Cumulative_cases, ending_cases = Q2max$Cumulative_cases, total_cases = Q2max$Cumulative_cases - Q2min$Cumulative_cases,
                                              starting_deaths= Q2min$Cumulative_deaths, ending_deaths = Q2max$Cumulative_deaths, total_deaths = Q2max$Cumulative_deaths - Q2min$Cumulative_deaths)
    
    covid_quarter = covid_quarter %>% add_row(quarter="Q3 / 2020", country = country_name,
                                              starting_cases= Q3min$Cumulative_cases, ending_cases = Q3max$Cumulative_cases, total_cases = Q3max$Cumulative_cases - Q3min$Cumulative_cases,
                                              starting_deaths= Q3min$Cumulative_deaths, ending_deaths = Q3max$Cumulative_deaths, total_deaths = Q3max$Cumulative_deaths - Q3min$Cumulative_deaths)
    
    covid_quarter = covid_quarter %>% add_row(quarter="Q4 / 2020", country = country_name,
                                              starting_cases= Q4min$Cumulative_cases, ending_cases = Q4max$Cumulative_cases, total_cases = Q4max$Cumulative_cases - Q4min$Cumulative_cases,
                                              starting_deaths= Q4min$Cumulative_deaths, ending_deaths = Q4max$Cumulative_deaths, total_deaths = Q4max$Cumulative_deaths - Q4min$Cumulative_deaths)
  }
  
  return(covid_quarter[-1,]) #Return all but first row because that was a dummy row
}

Qcovid = get.quarter.info(covid = covid)
quarter1 = Qcovid %>% filter(quarter == "Q1 / 2020")
quarter2 = Qcovid %>% filter(quarter == "Q2 / 2020")
quarter3 = Qcovid %>% filter(quarter == "Q3 / 2020")
quarter4 = Qcovid %>% filter(quarter == "Q4 / 2020")

```

**Quarter 1:**
```{r,echo=FALSE}
summary(quarter1)
```
**Quarter 2:**
```{r,echo=FALSE}
summary(quarter2)
```
**Quarter 3:**
```{r,echo=FALSE}
summary(quarter3)
```
**Quarter 4:**
```{r,echo=FALSE}
summary(quarter4)
```


### Cases 

We can take a look at how the average number of new cases changes in each quarter. From the plot below, we can see that the number of average cases across all countries seem to increase from Quarter 1 of 2020 to Quarter 4: 
```{r,echo=FALSE}
mean_cases_per_q = tibble(quarter = c(1,2,3, 4),
                          means = c(mean(quarter1$total_cases),
                                    mean(quarter2$total_cases),
                                    mean(quarter3$total_cases),
                                    mean(quarter4$total_cases)))

ggplot(data=mean_cases_per_q,aes(x=quarter, y=means)) + 
  geom_line()+
  geom_point()+
  xlab("Quarter (ie. 1:Q1)")+
  ylab("Number of Cases") +
  ggtitle("Average Number of New Cases per Quarter")

```

We can also plot a line graph to identify the behavior of the number of new cases per country. As we can see from the graph below, we have a one country that with a great number of new cases in quarter 4.
```{r,echo=FALSE}

Qcovid$category = rep(-1,dim(Qcovid)[1])
index1 = which(Qcovid$quarter == "Q1 / 2020")
index2 = which(Qcovid$quarter == "Q2 / 2020")
index3 = which(Qcovid$quarter == "Q3 / 2020")
index4 = which(Qcovid$quarter == "Q4 / 2020")

Qcovid$category[index1] = 1
Qcovid$category[index2] = 2
Qcovid$category[index3] = 3
Qcovid$category[index4] = 4

ggplot(data=Qcovid,aes(x=category, y=total_cases, group=country )) + 
  geom_line(alpha=0.3)+
  geom_point(alpha=0.3)+
  xlab("Quarter (ie. 1:Q1)")+
  ylab("Number of Cases") +
  ggtitle("Country's new cases per quarter")
```

If we remove the top 3 countries we are able to zoom on the countries with less than 2,500,000 cases in quarter 4 of 2020.We can clearly see that the number of new cases in each country significantly increased from the beginning of the Pandemic (Quarter 1).

```{r,echo=FALSE}
outlier_country = Qcovid$country[which(Qcovid$total_cases == max(Qcovid$total_cases))]
Qcovid_copy =Qcovid[-c(which(Qcovid$country == outlier_country)),]

outlier_country = Qcovid_copy$country[which(Qcovid_copy$total_cases == max(Qcovid_copy$total_cases))]
Qcovid_copy =Qcovid_copy[-c(which(Qcovid_copy$country == outlier_country)),]

outlier_country = Qcovid_copy$country[which(Qcovid_copy$total_cases == max(Qcovid_copy$total_cases))]
Qcovid_copy =Qcovid_copy[-c(which(Qcovid_copy$country == outlier_country)),]

Qcovid_copy$category = rep(-1,dim(Qcovid_copy)[1])
index1 = which(Qcovid_copy$quarter == "Q1 / 2020")
index2 = which(Qcovid_copy$quarter == "Q2 / 2020")
index3 = which(Qcovid_copy$quarter == "Q3 / 2020")
index4 = which(Qcovid_copy$quarter == "Q4 / 2020")

Qcovid_copy$category[index1] = 1
Qcovid_copy$category[index2] = 2
Qcovid_copy$category[index3] = 3
Qcovid_copy$category[index4] = 4

ggplot(data=Qcovid_copy,aes(x=category, y=total_cases, group=country )) + 
  geom_line(alpha=0.2)+
  geom_point(alpha=0.2)+
  xlab("Quarter (ie. 1:Q1)")+
  ylab("Number of Cases") +
  ggtitle("Country's new cases per quarter")
```

The darker contrast in the lines and points lets us know that majority of the countries in Q4 have less than 500,000 new cases. If we look at the summary statistic for quarter 4 at the beginning of section 4.1.3 we are able to see that the mean for the total number of new cases for all countries is around 202,655; however the median lets us know that at least half the data has less than 5,513 new cases in Quarter 4. 

### Deaths
We can take a look at how the average number of new deaths changes in each quarter. From the plot below, we can see that the number of average cases across all countries seem to increase from Quarter 1 of 2020 to Quarter 4; however from Quarter 2 to Quarter 3 we see that the rate of deaths stays constant: 

```{r,echo=FALSE}
mean_deaths_per_q = tibble(quarter = c(1,2,3, 4),
                          means = c(mean(quarter1$total_deaths),
                                    mean(quarter2$total_deaths),
                                    mean(quarter3$total_deaths),
                                    mean(quarter4$total_deaths)))

ggplot(data=mean_deaths_per_q,aes(x=quarter, y=means)) + 
  geom_line()+
  geom_point()+
  xlab("Quarter (ie. 1:Q1)")+
  ylab("Number of Deaths") +
  ggtitle("Average Number of Deaths at each Quarter")

```

We can also plot a line graph to identify the behavior of the number of deaths per country. One important thing to point out is that the top line (country) had a huge increase in the number of deaths from Q1 to Q2, with a noticble drop at Q3, but back to a great number of deaths in Q4.
```{r,echo=FALSE}
ggplot(data=Qcovid,aes(x=category, y=total_deaths, group=country )) + 
  geom_line(alpha=0.3)+
  geom_point(alpha=0.3)+
  xlab("Quarter (ie. 1:Q1)")+
  ylab("Number of Deaths") +
  ggtitle("Country's deaths per quarter")
```

If we remove the top 4 countries we are able to zoom on the countries with less than 50,000 deaths in quarter 4 of 2020. 
```{r,echo=FALSE}
outlier_country = Qcovid$country[which(Qcovid$total_deaths == max(Qcovid$total_deaths))]
Qcovid_copy2 =Qcovid[-c(which(Qcovid$country == outlier_country)),]

outlier_country = Qcovid_copy2$country[which(Qcovid_copy2$total_deaths == max(Qcovid_copy2$total_deaths))]
Qcovid_copy2 =Qcovid_copy2[-c(which(Qcovid_copy2$country == outlier_country)),]

outlier_country = Qcovid_copy2$country[which(Qcovid_copy2$total_deaths == max(Qcovid_copy2$total_deaths))]
Qcovid_copy2 =Qcovid_copy2[-c(which(Qcovid_copy2$country == outlier_country)),]

outlier_country = Qcovid_copy2$country[which(Qcovid_copy2$total_deaths == max(Qcovid_copy2$total_deaths))]
Qcovid_copy2 =Qcovid_copy2[-c(which(Qcovid_copy2$country == outlier_country)),]


ggplot(data=Qcovid_copy2,aes(x=category, y=total_deaths, group=country )) + 
  geom_line(alpha=0.2)+
  geom_point(alpha=0.2)+
  xlab("Quarter (ie. 1:Q1)")+
  ylab("Number of Deaths") +
  ggtitle("Country's Deaths per quarter")
```

As we can see the most countries had an increase in deaths from Q1 to Q2. From Q2 to Q3 we can see that some countries resulted in a negative change while other had an increase in deaths. On average, the rate of deaths from Q2 to Q3 seems constant (see 1st graph on section 4.1.5). In quarter 4 we are able to see that most countries had an increase in deaths from Q3 to Q4. It might be hard to spot these trends from this graph, but the summary statistics from section 4.1.3 support these claims.

## GDP Dataset 
The GDP dataset we used can be found here [here](https://www.theglobaleconomy.com/rankings/gdp_current_local_currency/).
This data set contains 120 observations with 5 variables: 

- Countries: The name of the country 
- Latest_data_from: The date of which the latest data is from
- Latest_value: GDP in billion local currency units
- Change_3_months: The change of GDP from past quarter to current
- Change_12_months: The change of GDP since last year 

### Countries
There is a total of 119 countries in this dataset (the remaining 1 is not a country). We can visualize which countries by observing the following map: 
```{r,echo=FALSE}
gdp <- read.csv(file = 'gdp.csv', header = FALSE)


#DATA PREPROCESSIG 

country_names = c()
data_from = c()
latest_value = c()
change_3_months = c()
change_12_months = c()

#Get Country names 
range = seq(1,dim(gdp)[1],by = 6)
for (i in range){
  country_names = append(country_names, gdp[i,1])
}

#Get datafrom 
range = seq(2,dim(gdp)[1],by = 6)
for (i in range){
  data_from = append(data_from, gdp[i,1])
}

#Get latest value  
range = seq(3,dim(gdp)[1],by = 6)
for (i in range){
  latest_value = append(latest_value, gdp[i,1])
}

#Get 3 month change  
range = seq(4,dim(gdp)[1],by = 6)
for (i in range){
  change_3_months = append(change_3_months, gdp[i,1])
}

#Get 12 month change  
range = seq(5,dim(gdp)[1],by = 6)
for (i in range){
  change_12_months = append(change_12_months, gdp[i,1])
}

#Merge into a tibble 
gdp <- tibble(Countries=country_names,
              Latest_data_from = data_from,
              Latest_value=latest_value,
              Change_3_months=change_3_months,
              Change_12_months= change_12_months)

iso3 <- read.csv("iso3.csv")
names = c()
codes = c()
for (i in 0:dim(iso3)[1]){
  row = iso3[i,]
  c = substr(row,1,3)
  n = substr(row,5,nchar(row))
  names = append(names, n)
  codes = append(codes, c)
}
iso3_df = tibble(country = names, iso3 = codes, using_these_countries = rep(1,length(names)))
iso3_df = iso3_df %>% add_row(country = "Palestine",
                              iso3 = "PSE",
                              using_these_countries = 1)
iso3_df = iso3_df %>% add_row(country = "Republic of Korea",
                              iso3 = "PRK",
                              using_these_countries = 1)
iso3_df = iso3_df %>% add_row(country = "Moldova",
                              iso3 = "MDA",
                              using_these_countries = 1)
iso3_df = iso3_df %>% add_row(country = "Tanzania",
                              iso3 = "TZA",
                              using_these_countries = 1)
iso3_df = iso3_df %>% add_row(country = "Bolivia",
                              iso3 = "BOL",
                              using_these_countries = 1)
iso3_df = iso3_df %>% add_row(country = "Brunei",
                              iso3 = "BRN",
                              using_these_countries = 1)
iso3_df = iso3_df %>% add_row(country = "Burma (Myanmar)",
                              iso3 = "MMR",
                              using_these_countries = 1)
iso3_df = iso3_df %>% add_row(country = "Cape Verde",
                              iso3 = "CPV",
                              using_these_countries = 1)
iso3_df = iso3_df %>% add_row(country = "Iran",
                              iso3 = "IRN",
                              using_these_countries = 1)
iso3_df = iso3_df %>% add_row(country = "Russia",
                              iso3 = "RUS",
                              using_these_countries = 1)
iso3_df = iso3_df %>% add_row(country = "South Korea",
                              iso3 = "KOR",
                              using_these_countries = 1)
iso3_df = iso3_df %>% add_row(country = "Taiwan",
                              iso3 = "TWN",
                              using_these_countries = 1)
iso3_df = iso3_df %>% add_row(country = "USA",
                              iso3 = "USA",
                              using_these_countries = 1)
iso3_df = iso3_df %>% add_row(country = "United Kingdom",
                              iso3 = "GBR",
                              using_these_countries = 1)
iso3_df = iso3_df %>% add_row(country = "Vietnam",
                              iso3 = "VNM",
                              using_these_countries = 1)
dmy = merge(gdp,iso3_df, by.x = c("Countries"), by.y =c("country") )
dmy= dmy[,c(6,7)]

Map <- joinCountryData2Map(dmy, joinCode = "ISO3", nameJoinColumn="iso3")
mapCountryData(Map, nameColumnToPlot="using_these_countries", catMethod = "categorical",
               missingCountryCol = gray(.8),
               mapTitle = "Countries in the  dataset",
               addLegend = FALSE)
gdp = gdp[-1,]
gdp$Latest_value = as.numeric(gdp$Latest_value)

#Change 'Change_3_months' type to numeric instead of char 
numeric_change_3_months = c()
for (i in 1:length(gdp$Change_3_months)){
  word = gdp$Change_3_months[i]
  num = as.numeric(substr(word,1,nchar(word)-1))
  numeric_change_3_months = append(numeric_change_3_months,num)
}

gdp$Change_3_months = numeric_change_3_months

#Change 'Change_12_months' type to numeric instead of char 
numeric_change_12_months = c()
for (i in 1:length(gdp$Change_12_months)){
  word = gdp$Change_12_months[i]
  num = as.numeric(substr(word,1,nchar(word)-1))
  numeric_change_12_months = append(numeric_change_12_months,num)
}

gdp$Change_12_months = numeric_change_12_months
```

### Quarters  

As stated in the previous sections, we decided to look at the data on quarterly time frames. Since gdp is measured annually/quarterly, this dataset was not too difficult to find with a time frame that worked for us. Here is the distribution for the gdp information at each quarter.
```{r,echo=FALSE}
n1 = dim(gdp %>% filter(Latest_data_from == "Q1 / 2020" ))[1]
n2 = dim(gdp %>% filter(Latest_data_from == "Q2 / 2020" ))[1]
n3 = dim(gdp %>% filter(Latest_data_from == "Q3 / 2020" ))[1]
n4 = dim(gdp %>% filter(Latest_data_from == "Q4 / 2020" ))[1]

data1 = tibble(quarter=c("Q1 / 2020","Q2 / 2020","Q3 / 2020","Q4 / 2020"),
                      number_of_countries= c(n1,n2,n3,n4))
# # Basic piechart
# ggplot(data, aes(x="", y=number_of_countries, fill=quarter)) +
#   geom_bar(stat="identity", width=1, color="white") +
#   coord_polar("y", start=0)+
#   
#   theme_void() # remove background, grid, numeric labels

ggplot(data=data1, aes(x=quarter, y=number_of_countries)) +
  geom_bar(stat="identity")+
  xlab("Quarter")+
  ylab("Number of Countries") +
  ggtitle("Country's GDP information at each Quarter")
```

As we can see, the distribution is not uniform. There seems to be more information about a country's GDP at Q3.


We can examine a summary statistic at each quarter; however, since the GDP is in local currency we should exclude from showing the latest value since each country is not using the same currency. Instead, lets examine the change in gdp in 3 and 12 months. 

Also note that since Q1 and Q2 have low observations we should take these statistics for those quarters with caution...
```{r,echo=FALSE}
quarter1 = gdp %>% filter(Latest_data_from == "Q1 / 2020")
quarter1 = quarter1[,-c(2,3)]

quarter2 = gdp %>% filter(Latest_data_from == "Q2 / 2020")
quarter2 = quarter2[,-c(2,3)]

quarter3 = gdp %>% filter(Latest_data_from == "Q3 / 2020")
quarter3 = quarter3[,-c(2,3)]

quarter4 = gdp %>% filter(Latest_data_from == "Q4 / 2020")
quarter4 = quarter4[,-c(2,3)]
```

**Quarter 1:**
```{r,echo=FALSE}
summary(quarter1)
```
**Quarter 2:**
```{r,echo=FALSE}
summary(quarter2)
```
**Quarter 3:**
```{r,echo=FALSE}
summary(quarter3)
```
**Quarter 4:**
```{r,echo=FALSE}
summary(quarter4)
```

## GDP Change (3 and 12 Months)
To visualize the summary statistics lets display a boxplot for quarters 3 and 4 since those seem to have a promising number of observations. 
```{r,message=FALSE,echo=FALSE, warning=FALSE}
q34 = gdp %>% subset(Latest_data_from == c("Q3 / 2020","Q4 / 2020") )
q34 = q34[,-c(3)]

ggplot(data=q34, mapping=aes(x=Latest_data_from, y=Change_3_months)) +
  geom_boxplot() +
  xlab("Quarter")+
  ylab("GDP Change")+
  ggtitle("Distribution of GDP Change in the last 3 months across Quarter 3 and 4")
```

```{r,message=FALSE,echo=FALSE, warning=FALSE}
q34 = gdp %>% subset(Latest_data_from == c("Q3 / 2020","Q4 / 2020") )
q34 = q34[,-c(3)]

ggplot(data=q34, mapping=aes(x=Latest_data_from, y=Change_12_months)) +
  geom_boxplot() +
  xlab("Quarter")+
  ylab("GDP Change")+
  ggtitle("Distribution of GDP Change in the last 12 months across Quarter 3 and 4")
```

Comparing these two plots we can see that gdp change in q3 and q4 seem to have positive economical growth, whereas if we compare it to last year (12 month change) we can see that the average is slightly negative (-0.9363% change). See statistics on section 4.2.2. 

## GDP per Capita Dataset 
The GDP per Capita dataset we used can be found here [here](https://www.theglobaleconomy.com/rankings/GDP_per_capita_current_dollars/).
This data set contains 59 observations with 2 variables which is the country name and the GDP Per Capita (US Dollars). 

```{r,echo=FALSE}
gdp_per_capita = tibble(read.csv(file = 'gdp per capita.csv'))
ggplot(data=gdp_per_capita, aes(x= reorder(Location,GDP.per.capita), y=GDP.per.capita)) +
  geom_bar(stat="identity")+
  coord_flip()+# Horizontal bar plot 
  xlab("US Dollars")+
  ylab("Country")+
  ggtitle("GDP per capita in U.S. dollars")+
  theme(axis.text.y = element_text(size=7))

summary(gdp_per_capita)
```
The bar graph allows us to clearly see all the countries in the dataset along with its corresponding GDP per capita in descending order. As we can see from the summary, the average gdp per capita is about  $16,228.


# Inferential analysis 
```{r, echo=FALSE, message=FALSE, warning=FALSE}
#SET UP ENVIRONMENT FOR ANALYSIS

original_covid_data <- read_csv("https://covid19.who.int/WHO-COVID-19-global-data.csv") 
covid <- read_csv("https://covid19.who.int/WHO-COVID-19-global-data.csv")
gdp <- read.csv(file = 'gdp.csv', header = FALSE)

#DATA PREPROCESSING 

country_names = c()
data_from = c()
latest_value = c()
change_3_months = c()
change_12_months = c()

#Get Country names 
range = seq(1,dim(gdp)[1],by = 6)
for (i in range){
  country_names = append(country_names, gdp[i,1])
}

#Get datafrom 
range = seq(2,dim(gdp)[1],by = 6)
for (i in range){
  data_from = append(data_from, gdp[i,1])
}

#Get latest value  
range = seq(3,dim(gdp)[1],by = 6)
for (i in range){
  latest_value = append(latest_value, gdp[i,1])
}

#Get 3 month change  
range = seq(4,dim(gdp)[1],by = 6)
for (i in range){
  change_3_months = append(change_3_months, gdp[i,1])
}

#Get 12 month change  
range = seq(5,dim(gdp)[1],by = 6)
for (i in range){
  change_12_months = append(change_12_months, gdp[i,1])
}

#Merge into a tibble 
gdp <- tibble(Countries=country_names,
              Latest_data_from = data_from,
              Latest_value=latest_value,
              Change_3_months=change_3_months,
              Change_12_months= change_12_months)


#Check which countries from gdp are not in covid dataset 
gdp.distinct.country = gdp %>% distinct(Countries)
covid.distinct.country = covid %>% distinct(Country)

indexes = gdp.distinct.country$Countries %in% covid.distinct.country$Country
not_found = gdp.distinct.country$Countries[!indexes]

#Make sure they are not written as something else
#For this we are checking for a substring of each not found country in the covid dataset 
for (country in not_found){
  for (i in 1:dim(covid.distinct.country)[1]){
    subs = substr(country,1,3)
    if (grepl(subs, covid.distinct.country[i,1]$Country, fixed = TRUE)){
      #cat(country, ":", covid.distinct.country[i,1]$Country, "\n")
    }
  }
}


#Change the names of gdp coutries to match the covid countries dataset
i = which(gdp$Countries == 'Bolivia')
gdp$Countries[i] = "Bolivia (Plurinational State of)"

i = which(gdp$Countries == 'Brunei')
gdp$Countries[i] = "Brunei Darussalam"

i = which(gdp$Countries == 'Iran')
gdp$Countries[i] = "Iran (Islamic Republic of)"

i = which(gdp$Countries == 'Moldova')
gdp$Countries[i] = "Republic of Moldova"

i = which(gdp$Countries == 'Palestine')
gdp$Countries[i] = "occupied Palestinian territory, including east Jerusalem"

i = which(gdp$Countries == 'Russia')
gdp$Countries[i] = "Russian Federation"

i = which(gdp$Countries == 'Tanzania')
gdp$Countries[i] = "United Republic of Tanzania"

i = which(gdp$Countries == 'United Kingdom')
gdp$Countries[i] = "The United Kingdom"

i = which(gdp$Countries == 'Vietnam')
gdp$Countries[i] = "Viet Nam"

i = which(gdp$Countries == 'USA')
gdp$Countries[i] = "United States of America"

####Other names have to "other" names and this other name can be found on google and mapped to the covid dataset 
i = which(gdp$Countries == 'Burma (Myanmar)')
gdp$Countries[i] = "Myanmar"

i = which(gdp$Countries == 'Cape Verde')
gdp$Countries[i] = "Cabo Verde"

i = which(gdp$Countries == 'South Korea')
gdp$Countries[i] = "Republic of Korea"

#Sanity check  
gdp.distinct.country = gdp %>% distinct(Countries)
covid.distinct.country = covid %>% distinct(Country)

indexes2 = gdp.distinct.country$Countries %in% covid.distinct.country$Country
not_found2 = gdp.distinct.country$Countries[!indexes2]
#cat("From all the countries in the gdp dataset only these were not found in the covid dataset: ",not_found2,"\n")

#FILTER THE COUNTRIES IN GDP THAT ALSO BELONG TO COVID DATASET
gdp = gdp %>% filter(Countries != not_found2)
gdp = gdp[-c(which(gdp$Countries == "Macao")),] #Had to remove manually

#Get rows of interest from covid dataset 
row_index = covid$Country %in% gdp$Countries
covid = covid[row_index,]


##############################################################
covid <- covid %>% arrange(Date_reported)


get.quarter.info = function(covid){
  covid_quarter = tibble(quarter = "dmmy", country = "dmmy", starting_cases = -1, ending_cases = -1, total_cases = -1,
                         starting_deaths = -1, ending_deaths = -1, total_deaths = -1)
  
  all_countries = covid %>% distinct(Country)
  for (country_name in all_countries){
    one_country <- covid %>% filter(Country == country_name)
    Q1 = subset(one_country,Date_reported >= "2020-01-01" & Date_reported <= "2020-03-31")
    Q2 = subset(one_country,Date_reported >= "2020-04-01" & Date_reported <= "2020-06-30")
    Q3 = subset(one_country,Date_reported >= "2020-07-01" & Date_reported <= "2020-09-30")
    Q4 = subset(one_country,Date_reported >= "2020-10-01" & Date_reported <= "2020-12-31")
    
    Q1min =  Q1 %>% filter(Date_reported == min(Q1$Date_reported))
    Q1max =  Q1 %>% filter(Date_reported == max(Q1$Date_reported))
    
    Q2min =  Q2 %>% filter(Date_reported == min(Q2$Date_reported))
    Q2max =  Q2 %>% filter(Date_reported == max(Q2$Date_reported))
    
    Q3min =  Q3 %>% filter(Date_reported == min(Q3$Date_reported))
    Q3max =  Q3 %>% filter(Date_reported == max(Q3$Date_reported))
    
    Q4min =  Q4 %>% filter(Date_reported == min(Q4$Date_reported))
    Q4max =  Q4 %>% filter(Date_reported == max(Q4$Date_reported))
    
    covid_quarter = covid_quarter %>% add_row(quarter="Q1 / 2020", country = country_name,
                                              starting_cases= Q1min$Cumulative_cases, ending_cases = Q1max$Cumulative_cases, total_cases = Q1max$Cumulative_cases - Q1min$Cumulative_cases,
                                              starting_deaths= Q1min$Cumulative_deaths, ending_deaths = Q1max$Cumulative_deaths, total_deaths = Q1max$Cumulative_deaths - Q1min$Cumulative_deaths)
    
    covid_quarter = covid_quarter %>% add_row(quarter="Q2 / 2020", country = country_name,
                                              starting_cases= Q2min$Cumulative_cases, ending_cases = Q2max$Cumulative_cases, total_cases = Q2max$Cumulative_cases - Q2min$Cumulative_cases,
                                              starting_deaths= Q2min$Cumulative_deaths, ending_deaths = Q2max$Cumulative_deaths, total_deaths = Q2max$Cumulative_deaths - Q2min$Cumulative_deaths)
    
    covid_quarter = covid_quarter %>% add_row(quarter="Q3 / 2020", country = country_name,
                                              starting_cases= Q3min$Cumulative_cases, ending_cases = Q3max$Cumulative_cases, total_cases = Q3max$Cumulative_cases - Q3min$Cumulative_cases,
                                              starting_deaths= Q3min$Cumulative_deaths, ending_deaths = Q3max$Cumulative_deaths, total_deaths = Q3max$Cumulative_deaths - Q3min$Cumulative_deaths)
    
    covid_quarter = covid_quarter %>% add_row(quarter="Q4 / 2020", country = country_name,
                                              starting_cases= Q4min$Cumulative_cases, ending_cases = Q4max$Cumulative_cases, total_cases = Q4max$Cumulative_cases - Q4min$Cumulative_cases,
                                              starting_deaths= Q4min$Cumulative_deaths, ending_deaths = Q4max$Cumulative_deaths, total_deaths = Q4max$Cumulative_deaths - Q4min$Cumulative_deaths)
  }
  
  return(covid_quarter[-1,]) #Return all but first row because that was a dummy row
}

Qcovid = get.quarter.info(covid = covid)


################ Conversions################
#gdp is in billion local currency (First multiply by 1billion)
gdp$Latest_value = as.numeric(gdp$Latest_value) * 10^9
gdp$Latest_value = as.character(gdp$Latest_value)

######## USE 'gdp' AND 'Qcovid' DATAFRAMES 

copy_Qcovid = Qcovid
covid_gdp = data.frame(gdp[1:4])
covid_gdp = covid_gdp %>% filter(Latest_data_from == "Q3 / 2020") #data from 2020 only
covid_gdp = data.frame(merge(copy_Qcovid, covid_gdp, by.x = c("country", "quarter"), by.y = c("Countries", "Latest_data_from")))
covid_gdp$case_increase = unlist(c(covid_gdp[4] - covid_gdp[3]))
covid_gdp = data.frame(covid_gdp[,c(1, 9:11)])

population = read_csv('https://population.un.org/wpp/Download/Files/1_Indicators%20(Standard)/CSV_FILES/WPP2019_TotalPopulationBySex.csv')
population = population %>% filter(Time == "2019")
population = data.frame(population[,c(2,9)])
i = which(population$Location == "United Kingdom")
population$Location[i] = "The United Kingdom"
i = which(population$Location == "State of Palestine")
population$Location[i] = "occupied Palestinian territory, including east Jerusalem"
covid_gdp = merge(population, covid_gdp, by.x = "Location", by.y = "country")

#Convert population
covid_gdp$PopTotal = covid_gdp$PopTotal * 1000

#Proportion of the population infected with COVID during quarter 3.
covid_gdp$prp_case_increase = unlist(c(covid_gdp[5] / covid_gdp[2]))

######## 
#Change 'Change_3_months' type to numeric instead of char 
numeric_change_3_months = c()
for (i in 1:length(covid_gdp$Change_3_months)){
  word = covid_gdp$Change_3_months[i]
  num = as.numeric(substr(word,1,nchar(word)-1))
  numeric_change_3_months = append(numeric_change_3_months,num)
}

covid_gdp$Change_3_months = numeric_change_3_months

#Make into a tibble  
covid_gdp = tibble(covid_gdp)
covid_gdp$Latest_value =  as.numeric(covid_gdp$Latest_value)
covid_gdp2 = covid_gdp %>% select(Location, Change_3_months,prp_case_increase)
covid_gdp2$rank_increase = rank(covid_gdp2$prp_case_increase)
covid_gdp2$increase_cat = cut(covid_gdp2$rank_increase, breaks = c(0,20,40,59), labels = c(1, 2, 3))
covid_gdp2 = covid_gdp2 %>% select(Location, increase_cat, Change_3_months)

gdp_per_capita = read.csv(file = 'gdp per capita.csv')
covid_gdp2 = merge(covid_gdp2, gdp_per_capita, by.x = c("Location"), by.y = c("Location"))
covid_gdp2$rank_gdp = rank(covid_gdp2$GDP.per.capita)
covid_gdp2$gdp_cat = cut(covid_gdp2$rank_gdp, breaks = c(0,20,40,59), labels = c(1, 2, 3))
covid_gdp2 = covid_gdp2 %>% select(Location, Change_3_months, increase_cat, gdp_cat)
```
We propose the following two-factor ANOVA model to explain the variance observed in the percentage GDP change in quarter 3 for each country: $Y_{ijk} = \mu_{..} + \alpha_{i} + \beta_{j} + \epsilon_{ijk}$, where $\mu_{..}$ is the parameter for the average of all countries percentage GDP change in quarter 3 and $\alpha_{i}$ and $\beta_{j}$ represent the linear parameters for prediction of mean percentage GDP change. $\alpha_{i}$ are the linear parameters for the proportion of the population infected with COVID-19 in quarter 3, where $i = {1, 2, 3}$ are the groups for countries with relative levels of the proportion of their population infected: 1 - Lowest, 2 - Moderate, 3 - Highest $\beta_{j}$ are the linear parameters for GDP per capita of each country, where $j = {1, 2, 3}$ are the groups for countries with relative levels of wealth measured in GDP per capita: 1 - Poor, 2 - Moderate, 3 - Wealthy. $Y_{ijk}$ is the parameter for the kth observation (country GDP change) of the ith group of $\alpha$ (proportion of the population infected with COVID-19) and jth group of $\beta$ (GDP per capita) where k = {1, ... , 52 = number of countries/observations}.
We will test two null hypotheses with our ANOVA model: $H_0: \alpha_1 = \alpha_2 = \alpha_3 = 0$ and $H_0: \beta_1 = \beta_2 = \beta_3 = 0$. Our alternative hypotheses are: $H_A:$ at least one $\alpha_{i}$ ≠ $\alpha_{k}$ where i ≠ k and $H_A:$ at least one $\beta_{j}$ ≠ $\beta_{k}$ where i ≠ k. 
Our model assumes equal variance between the levels of each factor, $\alpha_{i}$ and $\beta_{j}$ and that our observations of GDP change in quarter for each country are independent and distributed normally. 
**Final Presentation:** Two-factor ANOVA model: $Y_{ijk} = \mu_{..} + \alpha_{i} + \beta_{j} + (\alpha\beta)_{ij} + \epsilon_{ijk}$, where ... $(\alpha\beta)_{ij}$ is the interaction parameter between proportion of the population infected with COVID-19 and GDP per capita. 
We will test three null hypotheses with our ANOVA model: $H_0: \alpha_1 = \alpha_2 = \alpha_3 = 0$, $H_0: \beta_1 = \beta_2 = \beta_3 = 0$, and $H_0: (\alpha\beta)_{ij} = 0$ for all i, j. Our alternative hypotheses are: $H_A:$ at least one $\alpha_{i}$ ≠ 0, $H_A:$ at least one $\beta_{j}$ ≠ 0, and $H_A:$ at least one $(\alpha\beta)_{ij}$ ≠ 0.

```{r, echo=FALSE}
aov_model = aov(Change_3_months ~ increase_cat + gdp_cat, data = covid_gdp2)
summary(aov_model)

### Final Presentation ###
aov_model_2 = aov(Change_3_months ~ increase_cat + gdp_cat + increase_cat*gdp_cat, data = covid_gdp2)
summary(aov_model_2)

ggplot(covid_gdp2, aes(y = Change_3_months, x = increase_cat, fill = gdp_cat)) +
  geom_boxplot(position = position_dodge(width = .9)) +
  ylab("Percent GDP change during quarter 3") +
  xlab("Percent population infected with COVID-19 during quarter 3 \n (1 = Low, 2 = Moderate, 3 = High)") +
  ggtitle("Percent GDP change by COVID-19 infection and GDP per capita") +
  labs(fill = "GDP per capita\n (1 = Poor, \n 2 = Moderate, \n 3 = Wealthy)") +
  stat_summary(fun = median,
               geom = 'line',
               aes(group = gdp_cat, color = gdp_cat),
               position = position_dodge(width = .9),
               show.legend = FALSE,
               lwd = 1.5,
               color = "black") +
  stat_summary(fun = median, 
               geom = 'line', 
               aes(group = gdp_cat, color = gdp_cat), 
               position = position_dodge(width = .9),
               show.legend = FALSE,
               lwd = .75)
```  
The ANOVA model presents F-values: 1.748 and 0.685, p-values: 0.184, 0.508 for parameters: $\alpha_{i}$ and $\beta_{j}$, respectively. With a signicance level of $\alpha = .05$ we conclude that no $\alpha_{i}$ nor any $\beta_{j}$ are shown to be signficantly signficant in the prediction of variation in the means of all countries percentage GDP change in quarter 3. We may not reject either null hypothesis: $H_0: \alpha_1 = \alpha_2 = \alpha_3 = 0$ and $H_0: \beta_1 = \beta_2 = \beta_3 = 0$, and must conclude neither proportion of the population infected with COVID-19 in quarter 3 nor GDP per capita are significant in the prediction of variation observed in percentage GDP change in quarter 3.

**Final Presentation:** The ANOVA model presents F-values: 2.137, 0.838, and 4.000 & p-values: 0.12866, 0.43869, and 0.00683 for parameters: $\alpha_{i}$, $\beta_{j}$, and $(\alpha\beta)_{ij}$, respectively. With a significance level of $\alpha = .05$ we conclude that no $\alpha_{i}$ nor any $\beta_{j}$ are shown to be  signficant in the prediction of variation in the means of all countries percentage GDP change in quarter 3. We may not reject either null hypothesis: $H_0: \alpha_1 = \alpha_2 = \alpha_3 = 0$ and $H_0: \beta_1 = \beta_2 = \beta_3 = 0$, and must conclude neither proportion of the population infected with COVID-19 in quarter 3 nor GDP per capita are significant in the prediction of variation observed in percentage GDP change in quarter 3. However, with a p-value of 0.00683 for the interaction term $(\alpha\beta)_{ij}$ we may reject the null hypothesis and conclude that at least one $(\alpha\beta)_{ij}$ ≠ 0. 


```{r, echo=FALSE}
tukey_test = TukeyHSD(aov_model_2, ordered = TRUE); tukey_test
```

3:1-1:1 22.0450000   3.8458044 40.24420 0.0074849
3:1-3:3 20.5850000   0.7280497 40.44195 0.0367814
3:1-1:3 19.1662500   0.3282929 38.00421 0.0432679

3:1-1:1 - (Highest % COVID * Poor GDP) - (Lowest % COVID * Poor GDP)
3:1-3:3 - (Highest % COVID * Poor GDP) - (Highest % COVID * Wealthy GDP)
3:1-1:3 - (Highest % COVID * Poor GDP) - (Lowest % COVID * Wealthy GDP)

We perform a Tukey test to find which interaction terms are truly significantly different. We find that the interaction term $(\alpha\beta)_{31}$ is significantly different from: $(\alpha\beta)_{11}$ (p-value = 0.0074849), $(\alpha\beta)_{33}$ (p-value = 0.0367814), and $(\alpha\beta)_{13}$ (p-value = 0.0432679).


# Model Diagnostics

```{r, echo=FALSE}
plot(aov_model_2)
```

We produced diagnostic plots to determine if the assumptions of our model are correct. In our residuals vs. fitted plot we determine if there are any non-linear patterns present based on the presence of a non-horizontal pattern. Our data does not show any distinct non-horizontal pattern, so the assumption of linearity is likely fair. We next produced a Normal Q-Q plot to test the normality of our residuals, of which appear to align fairly well with the qq-line indicating our assumption of normality is fair. The Scale-Location plot we produced checks our assumption of equal variance between groups of a factor based on the horizontality of the plot, of which our data is fairly horizontal aside from a kink towards the middle. Our assumption of equal variance may be fair, but this kink in the plot gives some doubt to this assumption. The final diagnostic plot produced is the residuals vs. leverage graph which reveals any subjects that may be more influential to the data than desired, of which according to our graph there does not appear to be any.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
leveneTest(Change_3_months ~ increase_cat, data = covid_gdp2)
leveneTest(Change_3_months ~ gdp_cat, data = covid_gdp2)

### Final Presentation ###
leveneTest(Change_3_months ~ increase_cat*gdp_cat, data = covid_gdp2)
```

We perform a Levene's test on each factor respective to percentage GDP change in quarter 3 for each country, and found that at p-values: .8819 ($\alpha_{i}$) and .07331 ($\beta_{j}$) we may not reject the null hypothesis of equal variance between groups for either factor at a signicance level of $\alpha = .05$.

**Final Presentation:** Levene's test with just the interaction effects model produces a p-value = .1093, which does not allow the null hypothesis of equal variance to be rejected at $\alpha = .05$.


To further explore the possibility of a signficant interaction between percentage GDP change in quarter 3 for each country and proportion of the population infected with COVID-19 in quarter 3, the more signficant factor of our ANOVA analysis, we will perform the non-parametric Kruskal-Wallis Test as an alternative to ANOVA. With this model we will not have to make the assumption of normality in our data, nor the assumption of equal variances between groups. 
In this model we will test the null hypothesis: $H_0: F_1(x) = F_2(x) = F_3(x)$, where $F_1(x)$ is the CDF for the group with countries with the lowest proportion of their population infected, $F_2(x)$ the CDF for the group with moderate proportion, and $F_3(x)$ the CDF for the group with the highest proportion. Our alternative hypothesis is: $H_A:$ at least one $F_{i}$ ≠ $F_{k}$ where $i = {1, 2, 3}$ and i ≠ k.
```{r, echo=FALSE}
set.seed(20)
covid_gdp2$Rank = rank(covid_gdp2$Change_3_months, ties = "average")
ni = aggregate(Change_3_months ~ increase_cat, data = covid_gdp2, length)$Change_3_months
N = as.numeric(nrow(covid_gdp2))
SR.2 = var(covid_gdp2$Rank)
Ri = aggregate(Rank ~ increase_cat, data = covid_gdp2, mean)$Rank
KW.OBS = 1/SR.2*sum(ni*(Ri - (N+1)/2)^2)
perms.KW = sapply(1:2000,function(i){
  permuted.data = covid_gdp2
  permuted.data$increase_cat = sample(permuted.data$increase_cat, nrow(permuted.data), replace = FALSE)
  SR.2 = var(permuted.data$Rank)
  ni = aggregate(Rank ~ increase_cat, data = permuted.data,length)$Rank
  Ri = aggregate(Rank ~ increase_cat, data = permuted.data,mean)$Rank
  KW.i= 1/SR.2*sum(ni*(Ri - (N+1)/2)^2)
  return(KW.i)
})
p.value = mean(perms.KW > KW.OBS);
```
We perform 2000 permutations of Kruskal-Wallis and compare them to our observed statistic to calculate a p-value of 0.254 for our Kruskal-Wallis test, which at significance level of $\alpha = 0.05$, we may not reject the null hypothesis and must conclude that all CDFs are equivalent and there is no difference in variation of percentage GDP change in quarter 3 between each group of relative proportions of the population infected with COVID-19 in quarter 3. Given the failure of our non-parametric test to reject the null hypothesis, which does not rely on the same assumptions of the parametric ANOVA test, our conclusion that the variation observed in the percentage GDP change in quarter 3 between each country may not be explained by any group in the factor of proportions of the population infected with COVID-19 is reinforced.

# Conclusion
In our examination of the question of how COVID-19 affected economies around the world we explored 3 datasets: WHO Covid 19, GPD change per quarter, and GDP per capita. The WHO dataset included data from a large number of countries and we were able to see that the mean number of new cases increased per quarter. From the GDP dataset, we were able to gain insights on the change of gdp for each country, with the majority of the data coming from quarters 3 and 4. We saw that for Quarter 3, the change in gdp within a 3 month period was positive on average, meaning there was growth in the economy. However when we step back and look at the change of gdp within a year, we see it has a negative impact on the economy. Quarter 4 of 2020 gave identical behavior at the 3 and 12 month gdp change. Lastly we explored the GDP per capita dataset to get a sense a country's economic standing before the pandemic, and we were able to identify the mean and median gdp per capita in US dollars which correspond to $16,228.2 and $6,663.3.
We decided to use an analysis of variance as our model to explain the variance observed in the percentage GDP change in quarter 3 between each country. Our parameters for this model we hypothesized may be predictors of variance were proportions of the population infected with COVID-19 in quarter 3 and GDP per capita of each nation. We divided these factors into three relative levels each. We found that no group of either factor was statistically significant in its explanation of variance observed in percentage GDP change. We further explored the possibility that our assumptions of ANOVA were incorrect with diagnostic plotting and found that all of our assumptions were fair. To further our confidence in our conclusion we performed the non-parametric Kruskal-Wallis test and determined no significant difference between groups. We determine that the proportion of the population infected with COVID-19 and GDP per capita were not explicable in the variation observed in percentage GDP change in quarter 3 between each country. Our conclusion raises further questions about how GDP change is seemingly uniform across countries further affected by COVID and between rich and wealthy countries. It would seem this economic recovery observed in quarter 3 of 2020 was rather consistent throughout nations. Given the globalized nature of world economies this conclusion is expected as our economies are generally reflective of one another, at least on a global scale. Some caveats of our approach are that many developing countries do update GDP as frequently and lag behind on these statistics, so many poorer countries are not included. This can be an issue because it eliminates many parts of the world, and thus we cannot see the effects as clearly in these countries. Also many wealthier nations tend to keep their GDP statistics, which led to some being excluded from our dissection of nations whose most recently updated quarter was quarter 3. With these caveats in mind it is likely much of our cohort was formed of nations with comparatively moderate wealth on the global stage, which may have affected our conclusion as these economies perform more similar to each other than wealthier and poorer economies.

**Final Presentation:** We found that there is no overall effect of either proportion of the population infected with COVID-19 in quarter 3 nor GDP percentage change. We did, however, observe significantly different interaction effects. So, on average the mean GDP change is the same across % COVID infection levels and GDP per capita, although we did find that GDP change is affected by the % COVID infection levels and GDP per capita combination. We found that the interaction effect associated with the Highest % COVID infections and Poor GDP was significantly greater than the interactions effects associated with: Lowest % COVID infections and Poor GDP, Lowest % in COVID infections and Wealthy GDP, and Highest % COVID infections and Wealthy GDP. In other words, poor nations with high levels of COVID infections saw a greater increase in their GDP than poor and wealth nations with low levels of COVID infections and wealthy nations with high levels of infection.

# Acknowledgement {-}

# Reference {-}

WHO Coronavirus Disease (COVID-19) Global Data. (n.d.). Retrieved March 03, 2021, from https://covid19.who.int/

"GDP per capita, current dollars - Country rankings." TheGlobalEconomy.com, https://www.theglobaleconomy.com/rankings/GDP_per_capita_current_dollars/

“Gross Domestic Product (GDP) around the World.” TheGlobalEconomy.com, www.theglobaleconomy.com/rankings/gdp_current_local_currency/. 

Ozili, Peterson K, and Thankom Arun. “Spillover of COVID-19: Impact on the Global Economy.” SSRN, 30 Mar. 2020, papers.ssrn.com/sol3/papers.cfm?abstract_id=3562570. 

Pradyot Ranjan Jena, Ritanjali Majhi, Rajesh Kalli, Shunsuke Managi, Babita Majhi,Impact of COVID-19 on GDP of major economies: Application of the artificial neural network forecaster, Economic Analysis and Policy, Volume 69, 2021, Pages 324-339, ISSN 0313-5926, https://doi.org/10.1016/j.eap.2020.12.013.(https://www.sciencedirect.com/science/article/pii/S0313592620304604)

Luo, Shaowen and Tsang, Kwok Ping, China and World Output Impact of the Hubei Lockdown During the Coronavirus Outbreak (October 2020). Contemporary Economic Policy, Vol. 38, Issue 4, pp. 583-592, 2020, Available at SSRN: https://ssrn.com/abstract=3704366 or http://dx.doi.org/10.1111/coep.12482


# Appendix {-}

```{r ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE}
```

# Session info {-}

```{r}
sessionInfo()
```
