---
title: "Template for Project 2 Data Analysis Report (replace with own title)"
author: "(Your name, student ID here, and your team ID)"
date: "(Date on which the report is written)"
output:
  html_document:
    df_print: paged
    number_sections: yes
---
```{r, echo=FALSE}
library(tidyverse)
```

# Abstract 

<span style='color:blue'> 
A (very) short summary of the report. As an example, you can simply write one sentence for each section in the report. 
</span>



# Introduction

COVID-19 came to shock the world socially, politically, and economically. Many governments made the decision to lockdown their countries in response to COVID-19 as a way to limit the spread of the virus. This came with direct costs to economic activities as many businesses were forced to halt their operations or adapt to regulations in order to keep productivity afloat. In this paper, we measure the impact of COVID-19 on the economy by examining the effects of COVID-related deaths and cases on GDP. We use GDP as a measurement of the economy as it tracks income and spending in the economy, and it can be compared with other coutries and across time. We also note the various lockdown announcements in March of 2020 to carefully observe the changes in GDP around that time. 
 
# Background 

For our data, we use a csv file containing COVID-19 from the WHO website which can be found [here](https://covid19.who.int/WHO-COVID-19-global-data.csv). This dataset consists of 8 variables: the date reported, country code, country, WHO region, new cases, cumulative cases, new deaths, and cumulative deaths. Information about WHO regions and country codes can be found on the WHO website. The dataset is maintained and updated regularly by WHO. The WHO makes a statement about the dataset in their overview that "all counts are subject to variations in case detection, definitions, laboratory test, and reporting strategies between countries, states, and territories." The case/death data is based on WHO case definitions which can be found [here](https://www.who.int/publications/i/item/who-2019-nCoV-surveillanceguidance-2020.8). The collection of the data was started on the 3rd of January 2020, and collection is still on-going at the time this paper was written. The WHO sources their data through cases and deaths communicated by the International Health Regulation and reconciles this data through official minitries of health websites and social media accounts. Negative numbers may appear in the dataset as reconciliation exercises are performed to keep the data as accurate as possible. 

# Descriptive analysis 

```{r}
covid = read_csv("https://covid19.who.int/WHO-COVID-19-global-data.csv")
covid$Case_mortality_rate = covid$Cumulative_cases / covid$Cumulative_deaths
covid$Case_mortality_rate[is.nan(covid$Case_mortality_rate)] = 0

summary(covid$Date_reported)
summary(covid$New_cases)
summary(covid$Cumulative_cases)
summary(covid$New_deaths)
summary(covid$Cumulative_deaths)
```

# Inferential analysis 

We propose the following two-factor ANOVA model to explain the variance observed in the percentage GDP change in quarter 3 for each country: $Y_{ijk} = \mu_{..} + \alpha_{i} + \beta_{j} + \epsilon_{ijk}$, where $\mu_{..}$ is the parameter for the average of all countries percentage GDP change in quarter 3 and $\alpha_{i}$ and $\beta_{j}$ represent the linear parameters for prediction of mean percentage GDP change. $\alpha_{i}$ are the linear parameters for the proportion of the population infected with COVID-19 in quarter 3, where $i = {1, 2, 3}$ are the groups for countries with relative levels of the proportion of their population infected: 1 - Lowest, 2 - Moderate, 3 - Highest $\beta_{j}$ are the linear parameters for GDP per capita of each country, where $j = {1, 2, 3}$ are the groups for countries with relative levels of wealth measured in GDP per capita: 1 - Poor, 2 - Moderate, 3 - Wealthy. We will test two null hypotheses with our ANOVA model: $H_0: \alpha_1 = \alpha_2 = \alpha_3 = 0$ and $H_0: \beta_1 = \beta_2 = \beta_3 = 0$. Our alternative hypotheses are: $H_A:$ at least one $\alpha_{i}$ ≠ $\alpha_{k}$ where i ≠ k and $H_A:$ at least one $\beta_{j}$ ≠ $\beta_{k}$ where i ≠ k. Our model assumes equal variance between the levels of each factor, $\alpha_{i}$ and $\beta_{j}$ and that our observations of GDP change in quarter for each country are independent and distributed normally. 

```{r}
aov_model = aov(Change_3_months ~ increase_cat + gdp_cat, data = covid_gdp2)
summary(aov_model)
```
The ANOVA model presents F-values: 1.748 and 0.685, p-values: 0.184, 0.508 for parameters: $\alpha_{i}$ and $\beta_{j}$, respectively. With a signicance level of $\alpha = .05$ we conclude that no $\alpha_{i}$ nor any $\beta_{j}$ are shown to be signficantly signficant in the prediction of variation in the means of all countries percentage GDP change in quarter 3. We may not reject either null hypothesis: $H_0: \alpha_1 = \alpha_2 = \alpha_3 = 0$ and $H_0: \beta_1 = \beta_2 = \beta_3 = 0$, and must conclude neither proportion of the population infected with COVID-19 in quarter 3 nor GDP per capita are significant in the prediction of variation observed in percentage GDP change in quarter 3.

# Model Diagnostics

```{r}
plot(aov_model)
```

We produced diagnostic plots to determine if the assumptions of our model are correct. In our residuals vs. fitted plot we determine if there are any non-linear patterns present based on the presence of a non-horizontal pattern. Our data does not show any distinct non-horizontal pattern, so the assumption of linearity is likely fair. We next produced a Normal Q-Q plot to test the normality of our residuals, of which appear to align fairly well with the qq-line indicating our assumption of normality is fair. The Scale-Location plot we produced checks our assumption of equal variance between groups of a factor based on the horizontality of the plot, of which our data is fairly horizontal aside from a kink towards the middle. Our assumption of equal variance may be fair, but this kink in the plot gives some doubt to this assumption. The final diagnostic plot produced is the residuals vs. leverage graph which reveals any subjects that may be more influential to the data than desired, of which according to our graph there does not appear to be any.

```{r}
library(car)
leveneTest(Change_3_months ~ increase_cat, data = covid_gdp2)
leveneTest(Change_3_months ~ gdp_cat, data = covid_gdp2)
```

We perform a Levene's test on each factor respective to percentage GDP change in quarter 3 for each country, and found that at p-values: .8819 ($\alpha_{i}$) and .07331 ($\beta_{j}$) we may not reject the null hypothesis of equal variance between groups for either factor at a signicance level of $\alpha = .05$.

To further explore the possibility of a signficant interaction between percentage GDP change in quarter 3 for each country and proportion of the population infected with COVID-19 in quarter 3, the more signficant factor of our ANOVA analysis, we will perform the non-parametric Kruskal-Wallis Test as an alternative to ANOVA. With this model we will not have to make the assumption of normality in our data, nor the assumption of equal variances between groups. In this model we will test the null hypothesis: $H_0: F_1(x) = F_2(x) = F_3(x)$, where $F_1(x)$ is the CDF for the group with countries with the lowest proportion of their population infected, $F_2(x)$ the CDF for the group with moderate proportion, and $F_3(x)$ the CDF for the group with the highest proportion. Our alternative hypothesis is: $H_A:$ at least one $F_{i}$ ≠ $F_{k}$ where $i = {1, 2, 3}$ and i ≠ k.
```{r}
set.seed(20)
covid_gdp2$Rank = rank(covid_gdp2$Change_3_months, ties = "average")
ni = aggregate(Change_3_months ~ increase_cat, data = covid_gdp2, length)$Change_3_months
N = as.numeric(nrow(covid_gdp2))
SR.2 = var(covid_gdp2$Rank)
Ri = aggregate(Rank ~ increase_cat, data = covid_gdp2, mean)$Rank
KW.OBS = 1/SR.2*sum(ni*(Ri - (N+1)/2)^2)
perms.KW = sapply(1:2000,function(i){
  permuted.data = covid_gdp2
  permuted.data$increase_cat = sample(permuted.data$increase_cat, nrow(permuted.data), replace = FALSE)
  SR.2 = var(permuted.data$Rank)
  ni = aggregate(Rank ~ increase_cat, data = permuted.data,length)$Rank
  Ri = aggregate(Rank ~ increase_cat, data = permuted.data,mean)$Rank
  KW.i= 1/SR.2*sum(ni*(Ri - (N+1)/2)^2)
  return(KW.i)
})
p.value = mean(perms.KW > KW.OBS); p.value
```
We calculate a p-value of 0.254 for our Kruskal-Wallis test, which at significance level of $\alpha = 0.05$, we may not reject the null hypothesis and must conclude that all CDFs are equivalent and there is no difference in variation of percentage GDP change in quarter 3 between each group of relative proportions of the population infected with COVID-19 in quarter 3. Given the failure of our non-parametric test to reject the null hypothesis, which does not rely on the same assumptions of the parametric ANOVA test, our conclusion that the variation observed in the percentage GDP change in quarter 3 between each country may not be explained by any group in the factor of proportions of the population infected with COVID-19 is reinforced.

# Conclusion

<span style='color:blue'> 
Conclude your analysis in this section. You can touch on the following topics. 
</span> 

# Acknowledgement {-}

<span style='color:blue'>
By default, it is assumed that you have discussed this project with your teammates and instructors. List any other people that you have discussed this project with. 
</span>

# Reference {-}

<span style='color:blue'>
List any references you cited in the report. See [here](https://owl.purdue.edu/owl/research_and_citation/apa_style/apa_formatting_and_style_guide/in_text_citations_the_basics.html) for the APA format. 
</span> 

# Session info {-}

<span style='color:blue'>
Report information of your `R` session for reproducibility. 
</span> 


```{r}
sessionInfo()
```
